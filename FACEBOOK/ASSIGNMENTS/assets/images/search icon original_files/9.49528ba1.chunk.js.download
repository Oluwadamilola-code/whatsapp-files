(this["webpackJsonpebanqo-messenger"]=this["webpackJsonpebanqo-messenger"]||[]).push([[9],{103:function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return l}));var a=n(3),i=n(5),c=n(84),r=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){var i,r,o,s=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.length>2&&void 0!==s[2]?s[2]:1,r=s.length>3&&void 0!==s[3]?s[3]:20,e.prev=2,e.next=5,c.c.webchat.getWebChatChatSessions(t,n,i,r);case 5:return o=e.sent,e.abrupt("return","success"===o.data.status?o.data.data:[]);case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}(),o=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n,i){var r,o,s,u=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>3&&void 0!==u[3]?u[3]:1,o=u.length>4&&void 0!==u[4]?u[4]:40,e.prev=2,e.next=5,c.c.webchat.getWebChatInitialUserMessageHistory(t,n,i,r,o);case 5:s=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",[]);case 11:return e.abrupt("return",s?s.data:[]);case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n,a){return e.apply(this,arguments)}}(),s=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.c.webchat.getClientCode(t);case 3:return n=e.sent,e.abrupt("return",n.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return","404");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n,i,r=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:"bot",e.prev=3,e.next=6,c.c.webchat.getWebChatChatSessionMessages(t,n);case 6:return i=e.sent,e.abrupt("return","success"===i.data.status&&i.data.data);case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.c.webchat.sendChatToEmail(t);case 3:return n=e.sent,e.abrupt("return",n.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},106:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return r}));var a={},i=function(){var e=0;return function(){return e+=1}}();function c(e,t){var n=i();return a[e]||(a[e]={}),a[e][n]=t,{unsubscribe:function(){delete a[e][n],0===Object.keys(a[e]).length&&delete a[e]}}}function r(e,t){a[e]&&Object.keys(a[e]).forEach((function(n){return a[e][n](t)}))}},176:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(707),i=n(106),c={isConnected:!1,socket:null,interval:null,connect:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"new",n=this;this.socket&&(window.EBQ_WEBCHAT_SOCKET&&window.EBQ_WEBCHAT_SOCKET.destroy(),this.socket.destroy(),this.socket.close(),delete this.socket,window.EBQ_WEBCHAT_SOCKET=null,this.socket=null);return this.socket=a.a.connect("".concat("https://webchat-be.ebanqo.io"),{transports:["websocket"],rejectUnauthorized:!1}),this.socket.on("connect",(function(){e.isConnected=!0,window.EBQ_WEBCHAT_SOCKET=e.socket,console.log("Socket Connected!",e.socket),"new"===t?Object(i.a)("newSocketConnected",e.socket):Object(i.a)("exisitingSocketConnected",e.socket)})),this.socket.on("disconnect",(function(t){e.isConnected=!1,Object(i.a)("socketDisconnected",e.socket),console.log("Socket Disconnected",t),e.interval=window.setInterval((function(){if(e.isConnected)return clearInterval(e.interval),void(n.interval=null);n.connect("existing")}),5e3)})),this.socket.on("connect_error",(function(e){console.log("SOCKET_CONNECT_ERROR",e)})),this.socket}}},180:function(e,t,n){"use strict";t.a=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(n){return n instanceof DOMException&&(22===n.code||1014===n.code||"QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)&&e&&0!==e.length}}},181:function(e,t,n){"use strict";function a(e){return e.split(/[?#]/)[0]}n.d(t,"a",(function(){return a}))},727:function(e,t,n){"use strict";n.r(t);var a=n(3),i=n(5),c=n(8),r=n(60),o=n(4),s=n(0),u=n.n(s),l=n(2),d=n(165),f=n.n(d),v=n(325),b=n(103),p=n(716),h=n(717),m=n(718),O=n(84),g=function(){Object.prototype.toString;var e=function(e){return e},t=function(e){var t=null!=e&&"object"===typeof e&&this.prop in e;return this.parser(t?e[this.prop]:e)};return function(n,a){return n instanceof Array&&n.length?("[object Object]"!==Object.prototype.toString.call(a)&&(a={}),"function"!==typeof a.parser&&(a.parser=e),a.desc=a.desc?-1:1,n.sort((function(e,n){return e=t.call(a,e),n=t.call(a,n),a.desc*(e<n?-1:+(e>n))}))):[]}}(),j=function(e){return void 0===e||null===e||"object"===typeof e&&0===Object.keys(e).length||"string"===typeof e&&0===e.trim().length},w=n(106),_=n(176),E=n(349),S=function(e){e&&(O.a.defaults.headers.common.parent="".concat(e),O.b.defaults.headers.common.parent="".concat(e))},y=n(180),k=n(181),M=n.p+"static/media/doc.ef8f3762.svg",C=n.p+"static/media/audio.03c1c260.svg",B=n.p+"static/media/photo.80a54406.svg",T=function(e){return null===e||void 0===e?void 0:e.replace(/(?:https?:\/\/[^\s]+)|(?:\+?\d{10}\b)/g,(function(e){return null!==e&&void 0!==e&&e.startsWith("http")?'<a href="'+e+'" target="_blank">'+e+"</a>":'<a href="tel:'+e+'">'+e+"</a>"}))},A=n(7),x=new v.Howl({src:["/notify.mp3"]}),I=u.a.lazy((function(){return Promise.all([n.e(0),n.e(4),n.e(1),n.e(7)]).then(n.bind(null,728))})),U=u.a.lazy((function(){return Promise.all([n.e(0),n.e(1),n.e(8)]).then(n.bind(null,726))})),P=u.a.lazy((function(){return Promise.resolve().then(n.bind(null,26))})),D=u.a.lazy((function(){return n.e(10).then(n.bind(null,731))}));t.default=function(e){var t=e.versionType,n=Object(l.q)().clientCode,u=Object(l.m)(),d=Object(s.useState)(!0),v=Object(o.a)(d,2),W=v[0],N=v[1],F=Object(s.useState)(""),H=Object(o.a)(F,2),Q=H[0],L=H[1],R=Object(s.useState)(""),G=Object(o.a)(R,2),z=G[0],q=G[1],K=Object(s.useState)(!1),V=Object(o.a)(K,2),J=V[0],Y=V[1],$=Object(s.useState)([]),X=Object(o.a)($,2),Z=X[0],ee=X[1],te=Object(s.useState)([]),ne=Object(o.a)(te,2),ae=ne[0],ie=ne[1],ce=Object(s.useState)([]),re=Object(o.a)(ce,2),oe=re[0],se=re[1],ue=Object(s.useState)([]),le=Object(o.a)(ue,2),de=le[0],fe=le[1],ve=Object(s.useState)(null),be=Object(o.a)(ve,2),pe=be[0],he=be[1],me=Object(s.useState)(null),Oe=Object(o.a)(me,2),ge=Oe[0],je=Oe[1],we=Object(s.useState)(!0),_e=Object(o.a)(we,2),Ee=_e[0],Se=_e[1],ye=Object(s.useState)(null),ke=Object(o.a)(ye,2),Me=ke[0],Ce=ke[1],Be=Object(s.useState)(!1),Te=Object(o.a)(Be,2),Ae=Te[0],xe=Te[1],Ie=Object(s.useState)({}),Ue=Object(o.a)(Ie,2),Pe=Ue[0],De=Ue[1],We=Object(s.useState)([]),Ne=Object(o.a)(We,2),Fe=Ne[0],He=Ne[1],Qe=Object(s.useState)(!1),Le=Object(o.a)(Qe,2),Re=Le[0],Ge=Le[1],ze=Object(s.useState)(!1),qe=Object(o.a)(ze,2),Ke=qe[0],Ve=qe[1],Je=Object(s.useState)(""),Ye=Object(o.a)(Je,2),$e=Ye[0],Xe=Ye[1],Ze=Object(s.useState)(!1),et=Object(o.a)(Ze,2),tt=et[0],nt=et[1],at=Object(s.useState)(!1),it=Object(o.a)(at,2),ct=it[0],rt=it[1],ot=Object(s.useState)(!1),st=Object(o.a)(ot,2),ut=(st[0],st[1],Object(s.useState)(!1)),lt=Object(o.a)(ut,2),dt=lt[0],ft=lt[1],vt=Object(s.useState)(!1),bt=Object(o.a)(vt,2),pt=bt[0],ht=(bt[1],Object(s.useState)({type:"",status:!1})),mt=Object(o.a)(ht,2),Ot=mt[0],gt=mt[1],jt=Object(s.useState)({}),wt=Object(o.a)(jt,2),_t=wt[0],Et=wt[1],St=Object(s.useState)({visible:!1,modalData:{}}),yt=Object(o.a)(St,2),kt=yt[0],Mt=yt[1],Ct=Object(s.useState)(!1),Bt=Object(o.a)(Ct,2),Tt=Bt[0],At=Bt[1],xt=Object(s.useState)(null),It=Object(o.a)(xt,2),Ut=It[0],Pt=It[1],Dt=Object(s.useState)(!1),Wt=Object(o.a)(Dt,2),Nt=Wt[0],Ft=Wt[1],Ht=Object(s.useState)(null),Qt=Object(o.a)(Ht,2),Lt=Qt[0],Rt=Qt[1],Gt=Object(s.useState)(null),zt=Object(o.a)(Gt,2),qt=zt[0],Kt=zt[1],Vt=Object(s.useState)(!0),Jt=Object(o.a)(Vt,2),Yt=Jt[0],$t=Jt[1],Xt=Object(s.useState)(!1),Zt=Object(o.a)(Xt,2),en=Zt[0],tn=Zt[1],nn=Object(s.useState)(!1),an=Object(o.a)(nn,2),cn=an[0],rn=an[1],on=Object(s.useState)(""),sn=Object(o.a)(on,2),un=sn[0],ln=sn[1],dn=f.a.parse(u.search),fn=window.location.href;if(window.location!==window.parent.location)try{fn=window.parent.location.href}catch(Zn){fn=document.referrer}Object(s.useEffect)((function(){var e,t;if(en)return $t(!1);if((null===dn||void 0===dn||!dn.source)&&null!==pe&&void 0!==pe&&null!==(e=pe.security)&&void 0!==e&&e.is_active){if(pe&&null!==pe&&void 0!==pe&&pe.security){var n,a=pn(fn,null===pe||void 0===pe||null===(n=pe.security)||void 0===n?void 0:n.allowed_domains);return a&&$t(!0),void(!a&&$t(!1))}if(pe&&(null===pe||void 0===pe||!pe.security))return $t(!0);$t(!1)}return null!==dn&&void 0!==dn&&dn.source||null!==pe&&void 0!==pe&&null!==(t=pe.security)&&void 0!==t&&t.is_active?null!==dn&&void 0!==dn&&dn.source?$t(!0):void 0:$t(!0)}),[fn,pe,dn,en]),Object(s.useEffect)((function(){var e=Object(w.b)("exisitingSocketConnected",(function(e){if(qt){var t=qt.sender_id,n=qt.recipient_id;ge?ge.id!==e.id&&!0!==ge.connected&&(e.emit("send",{type:"connection",recipient_id:n,sender_id:t,token:(null===dn||void 0===dn?void 0:dn.token)||void 0}),je(e),xe(!0)):(je(e),xe(!0),e.emit("send",{type:"connection",recipient_id:n,sender_id:t,token:(null===dn||void 0===dn?void 0:dn.token)||void 0}))}})),t=Object(w.b)("socketDisconnected",(function(e){xe((function(e){return!1}))})),n=Object(w.b)("newSocketConnected",(function(e){xe((function(e){return!0})),je((function(t){return e}))})),a=Object(w.b)("block",(function(e){$t(!1)}));return function(){n.unsubscribe(),t.unsubscribe(),e.unsubscribe(),a.unsubscribe()}}),[qt,ge,dn]),Object(s.useEffect)((function(){null!==qt&&void 0!==qt&&qt.recipient_id&&ge.emit("send",{type:"connection",recipient_id:null===qt||void 0===qt?void 0:qt.recipient_id,sender_id:null===qt||void 0===qt?void 0:qt.sender_id,token:(null===dn||void 0===dn?void 0:dn.token)||void 0})}),[null===ge||void 0===ge?void 0:ge.connected,qt]),Object(s.useEffect)((function(){L(n),window.parent.postMessage("webchat_loaded",fn)}),[]),Object(s.useEffect)((function(){var e;if(dn.version&&delete dn.version,pe&&ge){var t,n;if(Object(y.a)())e=JSON.parse((null===(t=localStorage)||void 0===t?void 0:t.getItem("".concat(pe.agent_code,"_webchat_user_info")))||"null"),Kt(e);if(e&&e.sender_id)return Ce((function(t){return Object(r.a)(Object(r.a)({},t),e)})),window.EBQ_WEBCHAT_USER_INFO=e,e.rememberMe&&Y((function(e){return!1})),ge.emit("send",{type:"connection",recipient_id:e.recipient_id,sender_id:e.sender_id,token:(null===dn||void 0===dn?void 0:dn.token)||void 0}),null!==dn&&void 0!==dn&&null!==(n=dn.source)&&void 0!==n&&n.includes("appchat")?void hn(dn):void mn(e.sender_id,e.recipient_id,null===dn||void 0===dn?void 0:dn.source);pe&&pe.show_reg_form?j(dn)?wn():hn(dn):j(dn)?hn(dn):hn()}}),[pe]),Object(s.useEffect)((function(){Q&&(je(_.a.connect()),Q&&bn(Q))}),[Q]),Object(s.useEffect)((function(){var e;(null===ge||void 0===ge?void 0:ge.on)&&(null===ge||void 0===ge||null===(e=ge.off("receive",vn))||void 0===e||e.on("receive",vn))}),[ge]),Object(s.useEffect)((function(){var e=Object(w.b)("userMessage",(function(e){nt((function(e){return!1})),xe((function(e){return!0}));var t=window.EBQ_WEBCHAT_USER_INFO,n=t.sender_id,a=t.recipient_id;if(null===ge||void 0===ge||ge.emit("send",{type:"ack",sender_id:n,recipient_id:a,id:e.data.id}),e&&"incoming"===e.data.type){cn&&x.play(),window.parent.postMessage("user_message",fn);var i=de.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{quick_replies:[],buttons:[]})})),o=ae.filter((function(t){return t.timestamp!==e.data.timestamp}));ie((function(e){return o})),fe((function(t){return[].concat(Object(c.a)(i),[Object(r.a)(Object(r.a)({},e.data),{},{sender:"bot"})])})),Object(w.a)("scroll-message-trail",{})}if(e&&"outgoing"===e.data.type){var s=ae.filter((function(t){return t.timestamp!==e.data.timestamp})),u=oe.filter((function(t){return t.timestamp!==e.data.timestamp}));ie((function(e){return s})),fe((function(t){var n=Object(r.a)(Object(r.a)({},e.data),{},{date:(new Date).toISOString(),sender:"user",quick_replies:[]});return n.attachments&&n.attachments.length?[].concat(Object(c.a)(t),[Object(r.a)(Object(r.a)({},n),{},{msg_type:"attachment",allDelivered:!0})]):[].concat(Object(c.a)(t),[n])})),se((function(e){return u}))}})),t=Object(w.b)("typing",(function(e){nt((function(e){return!0})),Object(w.a)("scroll-message-trail",{}),Se((function(e){return!1}))}));return function(){e.unsubscribe(),t.unsubscribe()}}),[de,ae,oe,ge,cn]),Object(s.useEffect)((function(){window.EBQ_WEBCHAT_SENT_MESSAGES=ae}),[ae]),Object(s.useEffect)((function(){Object(w.a)("scroll-message-trail",{})}),[null===oe||void 0===oe?void 0:oe.length]),Object(s.useEffect)((function(){var e=Object(w.b)("minimize_widget",(function(){rn(!0)}));return function(){e.unsubscribe()}}),[]),Object(s.useEffect)((function(){window.EBQ_WEBCHAT_PENDING_MESSAGES=oe}),[oe]),Object(s.useEffect)((function(){window.EBQ_WEBCHAT_DELIVERED_MESSAGES=de,Se((function(e){return!1}))}),[de]),Object(s.useEffect)((function(){window.parent.postMessage("iframe_message",fn);var e=function(e){var t,n,a,i,c,r,o,s;(e.origin&&S(e.origin),null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.configs&&null!==e&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&null!==(a=n.configs)&&void 0!==a&&a.showChannelButtonsOnSignupForm)&&Rt(null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.configs);null!==e&&void 0!==e&&null!==(i=e.data)&&void 0!==i&&i.websiteURL?ln(null===e||void 0===e||null===(c=e.data)||void 0===c?void 0:c.websiteURL):ln(fn),"maximize_widget"===(null===(r=e.data)||void 0===r?void 0:r.message)&&rn(!1),"minimize_widget"===(null===(o=e.data)||void 0===o?void 0:o.message)&&rn(!0)},t=setTimeout((function(){L(n)}),1e3);return window.addEventListener("message",e,!1),function(){window.removeEventListener("message",e),clearTimeout(t)}}),[]);var vn=function(e){Object(w.a)(null===e||void 0===e?void 0:e.type,e)},bn=function(){var e=Object(i.a)(Object(a.a)().mark((function e(n){var i,c;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.b)(n);case 2:if("404"!==(i=e.sent)){e.next=7;break}return gt({type:"Not Found",status:!0}),N(!1),e.abrupt("return");case 7:if(window.parent.postMessage({type:"webchat_client_config",configs:null===i||void 0===i?void 0:i.data},fn),"v2"!==t){e.next=14;break}if(null!==i.data.options){e.next=13;break}return gt({type:"Does not exist on V2",status:!0}),N(!1),e.abrupt("return");case 13:Et(null===(c=i.data.options)||void 0===c?void 0:c.platforms);case 14:window.EBQ_WEBCHAT_CLIENT_INFO=i.data,he((function(e){return i.data})),N(!1);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pn=function(e,t){var n=new URL(e).hostname.toLowerCase();return t.some((function(e){var t=e.toLowerCase();if("*"===t)return!0;var a=n===t,i=t.startsWith("*.")&&n.endsWith(t.slice(2));return a||i}))},hn=function(e){var t={fullname:null,email:null,recipient_id:pe.agent_code,status:"new",timestamp:(new Date).getTime(),os:null===e||void 0===e?void 0:e.os,source:null===e||void 0===e?void 0:e.source,device_token:null===e||void 0===e?void 0:e.device_token,form:Object(r.a)(Object(r.a)({},e),{},{os:void 0,source:void 0,device_token:void 0}),page_url:Object(k.a)(un)};O.c.webchat.initialUserRegistration(t).then((function(n){if(Se(!1),"success"===n.data.status){var a=Object(r.a)(Object(r.a)(Object(r.a)({},t),n.data.data),{},{rememberMe:"appchat"===(null===e||void 0===e?void 0:e.source)});Kn(a)}})).catch((function(e){tn(!0),Se(!1)}))},mn=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){var i,o,s,u,l=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=l.length>2&&void 0!==l[2]?l[2]:"webchat",Se(!0),e.next=4,Object(b.e)(t,n,o);case 4:s=e.sent,Se((function(e){return!1})),u=(u=s?s.data&&Array.isArray(s.data.data)&&s.data.data.map((function(e){var t,n=Object(r.a)(Object(r.a)({},e),{},{icon:pe.icon,history:!0,allDelivered:!0,message:T((null===e||void 0===e?void 0:e.message)||(null===e||void 0===e?void 0:e.text)),attachments:"string"===typeof e.attachments?JSON.parse(null===e||void 0===e?void 0:e.attachments):null===e||void 0===e?void 0:e.attachments});return null!==e&&void 0!==e&&e.attachments&&null!==e&&void 0!==e&&null!==(t=e.attachments)&&void 0!==t&&t.length?Object(r.a)(Object(r.a)({},n),{},{msg_type:"attachment"}):n})):[])&&null!==(i=u)&&void 0!==i&&i.length?u:[],fe((function(e){return g([].concat(Object(c.a)(e),Object(c.a)(u)),{prop:"date",desc:!1})}));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),On=function(){Object(y.a)()&&localStorage.removeItem("".concat(pe.agent_code,"_webchat_user_info")),Y((function(e){return!0})),ee((function(e){return[]})),ie((function(e){return[]})),se((function(e){return[]})),fe((function(e){return[]})),window.EBQ_WEBCHAT_SOCKET&&window.EBQ_WEBCHAT_SOCKET.close()},gn=function(){At(!0),Sn(Me.sender_id,Me.recipient_id).then((function(e){return At(!1)}))},jn=function(e){Pt(e),Ft(!0)},wn=function(){Y((function(e){return!e}))},_n=function(e){He((function(t){return[].concat(Object(c.a)(t),[e])}))},En=function(){Ve(!1),Ge(!1),He([]),Pn({})},Sn=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){var i;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Se((function(e){return!0})),e.next=3,Object(b.d)(t,n);case 3:i=e.sent,ee((function(e){return i&&Array.isArray(i)?Object(c.a)(i):e})),Se((function(e){return!1}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),yn=function(e,t){var n=window.EBQ_WEBCHAT_PENDING_MESSAGES&&window.EBQ_WEBCHAT_PENDING_MESSAGES.map((function(n){var a=n;if(a.attachments){var i=a.attachments.map((function(n){return e===n.name?Object(r.a)(Object(r.a)({},n),{},{progress:t}):n}));a.attachments=i}return a}));se((function(e){return n}))},kn=function(e,t){var n=window.EBQ_WEBCHAT_PENDING_MESSAGES&&window.EBQ_WEBCHAT_PENDING_MESSAGES.map((function(n){var a=n;if(a.attachments){var i=a.attachments.map((function(n){return e===n.name?Object(r.a)(Object(r.a)({},n),{},{error:t}):n}));a.attachments=i}return a}));se((function(e){return n}))},Mn=function(e){var t=window.EBQ_WEBCHAT_PENDING_MESSAGES&&window.EBQ_WEBCHAT_PENDING_MESSAGES.filter((function(t){return e.timestamp===t.timestamp}))[0];(1===t.attachments.length&&An(t),t.attachments.length>1)&&(t.attachments.filter((function(e){return 100===e.progress})).length===t.attachments.length&&An(t))},Cn=function(){Ft(!1),Pt(null)},Bn=function(e,t){var n=e.name.split(".")[e.name.split(".").length-1];return t.check.test("/".concat(n))};function Tn(e){e.forEach((function(e,t){var n=new FileReader;n.onload=function(e){return function(){var c=Object(i.a)(Object(a.a)().mark((function i(c){var o,s;return Object(a.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o={url:n.result,type:e.type.split("/")[0],name:e.name,caption:0===t&&$e?$e:null,img_id:"".concat(e.name).concat((new Date).getTime())},!e.type.includes("video")){a.next=9;break}return a.next=4,Object(E.a)(e,{interval:1,start:2,end:2});case 4:return a.sent,s=Object(r.a)({},o),0===t&&Pn(s),_n(s),a.abrupt("return");case 9:0===t&&Pn(o),_n(o);case 11:case"end":return a.stop()}}),i)})));return function(e){return c.apply(this,arguments)}}()}(e),Xe(""),n.readAsDataURL(e)}))}var An=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.attachments.map((function(e){var t=e;return delete t.progress,delete t.img_id,t.thumbnail&&delete t.thumbnail,t})),e.next=3,O.c.webchat.sendMessage(Object(r.a)(Object(r.a)({},t),{},{attachments:n,page_url:Object(k.a)(un)})).then((function(e){"success"===e.data.status&&(window.EBQ_WEBCHAT_DELIVERED_MESSAGES.filter((function(t){return t.timestamp===e.data.data.timestamp})).length||ie((function(t){return[].concat(Object(c.a)(window.EBQ_WEBCHAT_SENT_MESSAGES),[Object(r.a)(Object(r.a)({},e.data.data),{},{sender:"user",msg_type:"attachment",allSent:!0})])})),se((function(e){return e.filter((function(e){return e.timestamp!==t.timestamp}))})))}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xn=Object(s.useState)({}),In=Object(o.a)(xn,2),Un=In[0],Pn=In[1],Dn=[{name:"image",desc:"Photo/Video",listType:"picture-card",accept:"image/png, image/jpeg, image/jpg, video/*",icon:p.a,check:/(\.|\/)(png|jpeg|jpg|3gp|mp4|webm)$/i,svg:B},{name:"audio",desc:"Audio",accept:"audio/*, application/ogg, application/x-flac",icon:h.a,check:/(\.|\/)(mpeg|wav|ogg|mp3|m4a|aac|flac|wma|mp4|midi)$/i,svg:C},{name:"application",desc:"Document",accept:"application/msword, application/vnd.ms-excel, application/vnd.ms-powerpoint, text/plain, application/pdf, .csv, .xls, .xlsx, .doc, .docx",check:/(\.|\/)(doc|docx|xls|xlsx|ppt|pptx|txt|pdf|csv*)$/i,icon:m.a,svg:M}],Wn=function(){Ve((function(e){return!e}))},Nn=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n,i,o;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:($e||t)&&(n={text:t||$e,sender_id:null===Me||void 0===Me?void 0:Me.sender_id,recipient_id:null===pe||void 0===pe?void 0:pe.agent_code,timestamp:(new Date).getTime(),page_url:Object(k.a)(un)},O.c.webchat.sendMessage(n).then((function(e){"success"===e.data.status&&(window.EBQ_WEBCHAT_DELIVERED_MESSAGES.filter((function(t){return t.timestamp===e.data.data.timestamp})).length||ie((function(t){return[].concat(Object(c.a)(window.EBQ_WEBCHAT_SENT_MESSAGES),[Object(r.a)(Object(r.a)({},e.data.data),{},{sender:"user"})])})),se((function(e){return e.filter((function(e){return e.timestamp!==n.timestamp}))})))})),i=window.EBQ_WEBCHAT_DELIVERED_MESSAGES.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{buttons:[],quick_replies:[]})})),fe((function(e){return i})),Xe(""),o=oe.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{buttons:[],quick_replies:[]})})),se((function(e){return[].concat(Object(c.a)(o),[Object(r.a)(Object(r.a)({},n),{},{date:(new Date).toISOString(),sender:"user"})])})),Object(w.a)("scroll-message-trail",{fromSendMessage:!0}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Fn=function(e){Xe(e.target.value)},Hn=function(e){var t=e.colons;Xe((function(e){return $e+t})),ft(!1)},Qn=function(){ft((function(e){return!e}))},Ln=function(){ft(!1)},Rn=function(){Ge((function(e){return!0}))},Gn=function(e){if(e.name===Un.name&&e.url===Un.url)if(Fe.length<2)He([]);else{var t=Fe.findIndex((function(t){return t.url===e.url&&t.name===e.name}));Pn(Fe[t-1]||Fe[t+1])}He((function(t){return t.filter((function(t){return t.name!==e.name||t.url!==e.url}))}))},zn=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n,o,s;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(t||Fe).map((function(e,t){var n=Object(r.a)(Object(r.a)({},e),{},{type:e.type,caption:e.caption||null});return["image","audio","video"].includes(e.type)||(n.type="file"),n})),o={attachments:n,sender_id:Me.sender_id,recipient_id:pe.agent_code,msg_type:"attachment",sender:"user",text:null,timestamp:(new Date).getTime()},se((function(e){return[].concat(Object(c.a)(e),[o])})),s=[],n.forEach((function(e){s.push(O.c.webchat.uploadFile({filename:e.name,data_url:e.url,img_id:e.img_id},yn).catch((function(t){var n,a,i,c;422===(null===t||void 0===t||null===(n=t.response)||void 0===n?void 0:n.status)&&kn(null===e||void 0===e?void 0:e.name,null===t||void 0===t||null===(a=t.response)||void 0===a||null===(i=a.data)||void 0===i||null===(c=i.data)||void 0===c?void 0:c.message)})))})),Promise.all(s).then((function(e){e.forEach(function(){var t=Object(i.a)(Object(a.a)().mark((function t(n){var i;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=window.EBQ_WEBCHAT_PENDING_MESSAGES&&window.EBQ_WEBCHAT_PENDING_MESSAGES.map((function(t){var n=t;if(n.attachments){var a=n.attachments.map((function(t){var n,a=e.find((function(e){var n;return(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data.img_id)===(null===t||void 0===t?void 0:t.img_id)}));return a?Object(r.a)(Object(r.a)({},t),{},{url:null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.data.url,data_url:a.config.data.data_url}):t}));n.attachments=a}return n})),se((function(e){return[].concat(Object(c.a)(e),[i])})),Mn(o);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())})),En();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),qn=function(e,t){var n=Fe,a=n.findIndex((function(t){return t.name===e.name&&t.url===e.url}));n[a]&&(n[a]=Object(r.a)(Object(r.a)({},n[a]),{},{caption:t}),He(n))},Kn=function(e){var t,n,a,i;if(Ce(e),mn(e.sender_id,e.recipient_id,null===e||void 0===e?void 0:e.source),null===(t=window.EBQ_WEBCHAT_SOCKET)||void 0===t||!t.connected){var o=_.a.connect();o.emit("send",{type:"connection",recipient_id:e.recipient_id,sender_id:e.sender_id,token:(null===dn||void 0===dn?void 0:dn.token)||void 0}),je(o)}(null!==(n=window.EBQ_WEBCHAT_SOCKET)&&void 0!==n&&n.connected&&window.EBQ_WEBCHAT_SOCKET.emit("send",{type:"connection",recipient_id:e.recipient_id,sender_id:e.sender_id,token:(null===dn||void 0===dn?void 0:dn.token)||void 0}),Kt(e),window.EBQ_WEBCHAT_USER_INFO=e,fe((function(t){return[].concat(Object(c.a)(t),[Object(r.a)(Object(r.a)({},e),{},{sender:"bot"})])})),Object(y.a)())&&(e.rememberMe&&(null===(a=localStorage)||void 0===a||a.setItem("".concat(pe.agent_code,"_webchat_user_info"),JSON.stringify(e))),!pe.show_reg_form&&(null===(i=localStorage)||void 0===i||i.setItem("".concat(pe.agent_code,"_webchat_user_info"),JSON.stringify(Object(r.a)(Object(r.a)({},e),{},{rememberMe:!0})))))},Vn=function(){var e=de.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{buttons:[]})}));fe((function(t){return e}))},Jn=function(e){if(e){var t=de.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{buttons:[]})}));return fe((function(e){return t})),void Mt({visible:!kt.visible,modalData:e})}Mt({visible:!kt.visible,modalData:{}})},Yn=function(e){Nn(e)},$n=function(e,t,n,a){if("web_url"===n)return Jn({url:a,title:e});Nn(e)},Xn=function(e,n){var a=Array.from(e.target.files);De(n);var i=a.filter((function(e){return!Bn(e,n)}));a.filter((function(e){return e.size>5242880})).length&&alert("You selected a file/files larger than 5MB, and any file larger than 5MB will be automatically filtered out of the selected files.");var c=a.filter((function(e){return Bn(e,n)&&!(e.size>5242880)}));i.length&&alert("You selected file(s) with incorrect format, and any file(s) with incorrect format will be automatically filtered out of the selected files."),c.length&&Tn(c),"v1"===t&&c.length&&Rn()};return Object(A.jsxs)(A.Fragment,{children:[!(W||!Yt)&&Object(A.jsx)(A.Fragment,{children:"v1"===t?Object(A.jsx)(U,{setIsWebchatAccessible:$t,showSignUpForm:J,chatSessions:Z,sentMessages:ae,pendingMessages:oe,deliveredMessages:de,versionType:t,clientInfo:pe,setSocket:je,socket:ge,handleUserLogOut:On,setIsMessageLoading:Se,isMessageLoading:Ee,isLoadingPreviousSessions:Tt,userInfo:Me,fetchUserPreviewSessions:gn,openUploadingMediaFilesPreviewModal:jn,isSocketConnected:Ae,toggleSignUpForm:wn,handledFileUpload:Xn,handleAddMediaToPreviewModal:_n,selectedFileType:Pe,setMediaPreviewInfo:He,mediaPreviewInfo:Fe,setActiveMedia:Pn,activeMedia:Un,showMediaUploadModal:Re,setShowMediaUploadModal:Ge,setShowUploadButtons:Ve,showUploadButtons:Ke,fileTypes:Dn,supportActive:pt,toggleUploadButtonsContainer:Wn,handleSendMessageToBot:Nn,messageTextInputValue:$e,handleTextInputValueChange:Fn,addEmoji:Hn,showEmojiPicker:dt,toggleEmojiPicker:Qn,closeEmojiPicker:Ln,openMediaPreviewModal:Rn,handleRemoveMediaFromPreviewModal:Gn,sendMediaFiles:zn,onCaptionInputChange:qn,showIsTypingIndicator:tt,handleAfterNewUserRegistration:Kn,handleLinkButtonForMobile:Vn,toggleLinkModal:Jn,linkModal:kt,handleQuickReplyAction:Yn,handleCarouselButton:$n,showUploadingMediaFilesPreviewModal:Nt,showMenu:ct,setShowMenu:rt,handldeFileUpload:function(e,t){var n=Array.from(e.target.files);De(t);var a=n.filter((function(e){return!Bn(e,t)}));n.filter((function(e){return e.size>5242880})).length&&alert("You selected a file/files larger than 5MB, and any file larger than 5MB will be automatically filtered out of the selected files.");var i=n.filter((function(e){return Bn(e,t)&&!(e.size>5242880)}));a.length&&alert("You selected file(s) with incorrect format, and any file(s) with incorrect format will be automatically filtered out of the selected files."),i.length&&Tn(i),i.length&&Rn()},closeMediaPreviewModal:En,uploadingMediaFilesPreview:Ut,closeUploadingMediaFilesPreviewModal:Cn,v1WidgetConfigs:Lt,userPageUrl:un}):Object(A.jsx)(I,{setIsWebchatAccessible:$t,setShowSignUpForm:Y,showSignUpForm:J,chatSessions:Z,sentMessages:ae,pendingMessages:oe,deliveredMessages:de,versionType:t,clientInfo:pe,setSocket:je,socket:ge,handleUserLogOut:On,setIsMessageLoading:Se,isMessageLoading:Ee,isLoadingPreviousSessions:Tt,userInfo:Me,fetchUserPreviewSessions:gn,openUploadingMediaFilesPreviewModal:jn,isSocketConnected:Ae,setIsSocketConnected:xe,toggleSignUpForm:wn,setScreenHistory:q,screenHistory:z,handledFileUpload:Xn,handleAddMediaToPreviewModal:_n,mediaPreviewInfo:Fe,setActiveMedia:Pn,showMediaUploadModal:Re,setShowUploadButtons:Ve,showUploadButtons:Ke,fileTypes:Dn,supportActive:pt,isLoading:W,activeChannelList:_t,uploadingMediaFilesPreview:Ut,closeUploadingMediaFilesPreviewModal:Cn,showUploadingMediaFilesPreviewModal:Nt,toggleUploadButtonsContainer:Wn,handleSendMessageToBot:Nn,messageTextInputValue:$e,handleTextInputValueChange:Fn,addEmoji:Hn,showEmojiPicker:dt,toggleEmojiPicker:Qn,closeEmojiPicker:Ln,openMediaPreviewModal:Rn,handleRemoveMediaFromPreviewModal:Gn,sendMediaFiles:zn,onCaptionInputChange:qn,showIsTypingIndicator:tt,handleAfterNewUserRegistration:Kn,handleLinkButtonForMobile:Vn,toggleLinkModal:Jn,linkModal:kt,handleQuickReplyAction:Yn,handleCarouselButton:$n,notFound:Ot,userPageUrl:un})}),!W&&!Yt&&Object(A.jsx)(D,{}),W&&Object(A.jsx)(P,{})]})}},84:function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return f}));var a=n(326),i=n.n(a),c=n(344),r=n(12),o=n(11),s=function(){return Object(o.a)((function e(t){Object(r.a)(this,e),this.client=void 0,this.client=t}),[{key:"getWebChatInitialUserMessageHistory",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:40;return this.client.get("/message/chat/".concat(e,"/").concat(t,"/?page=").concat(a,"&page_size=").concat(i,"&source=").concat(n))}},{key:"getWebChatChatSessions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40;return this.client.get("/message/history/".concat(e,"/").concat(t,"/?page=").concat(n,"&page_size=").concat(a))}},{key:"getWebChatChatSessionMessages",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40;return this.client.get("/message/history/session/".concat(e,"/").concat(t,"/?page=").concat(n,"&page_size=").concat(a))}},{key:"getClientCode",value:function(e){return this.client.get("/config/".concat(e))}},{key:"initialUserRegistration",value:function(e){return this.client.post("/connect",e)}},{key:"sendMessage",value:function(e){return this.client.post("/message",e)}},{key:"uploadFile",value:function(e,t){var n={onUploadProgress:function(n){var a=Math.round(100*n.loaded/n.total);t(e.filename,a)}};return this.client.post("/attachment/upload",e,n)}},{key:"sendChatToEmail",value:function(e){return this.client.post("/chathistory/email",e)}}])}(),u=s,l=function(){return Object(o.a)((function e(t){Object(r.a)(this,e),this.client=void 0,this.client=t}),[{key:"getUserLocation",value:function(){return this.client.get("/bigfoot/api/location?require_city=true")}}])}(),d=i.a.create({baseURL:"https://webchat-be.ebanqo.io"}),f=i.a.create({baseURL:"https://ost9cv8wr3.execute-api.us-east-2.amazonaws.com/prod"}),v={webchat:new u(d),userLocation:new l(f)};Object(c.a)(d,{retries:5,retryCondition:c.a.isNetworkError,retryDelay:c.a.exponentialDelay}),Object(c.a)(f,{retries:5,retryCondition:c.a.isNetworkError,retryDelay:c.a.exponentialDelay});t.c=v}}]);
//# sourceMappingURL=9.49528ba1.chunk.js.map